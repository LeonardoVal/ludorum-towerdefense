{"version":3,"sources":["../src/__prologue__.js","../src/oop.js","../src/manifest.js","../src/path.js","../src/video.js","../src/sound.js","../src/main.js","../src/logic.js","../src/units.js","../src/shots.js","../src/towers.js","../src/towerdefense.js","../src/ai-players.js","../src/scenarios.js","../src/__epilogue__.js"],"names":["base","Sermat","inveniemus","initializing","fnTest","cls","declare","exports","constants","ticks","money","hitpoints","mediPackCost","mediPackFactor","mediPackHealth","towerBuildCost","towerBuildFactor","towerBuildNumber","events","click","mousemove","mouseover","mouseout","contextmenu","died","shot","hit","accomplished","playerDefeated","moneyChanged","waveCreated","waveFinished","waveDefeated","healthChanged","unitSpawned","towerNumberChanged","Class","extend","prop","modifier","_super","this","prototype","name","test","fn","tmp","ret","apply","arguments","init","constructor","MazeStrategy","manhattan","maxDXDY","diagonalShortCut","euclidean","euclideanNoSQR","custom","air","Direction","right","top","left","bottom","Point","Steps","WithDiagonals","OnlyStraight","x","y","clone","add","pt","subtract","projectOn","norm","Math","sqrt","square","scale","factor","normalize","regularize","round","random","toDirection","Size","width","height","divide","sz","Maze","size","path","turrets","gridDim","grid","i","a","j","push","start","end","length","paths","tryBuild","point","weight","tryRemove","getPath","View","running","visuals","background","undefined","showGrid","mazeSize","pause","visual","Array","isArray","n","sort","b","z","remove","index","indexOf","splice","draw","drawBackground","drawSpawn","drawHome","drawPath","drawTurrets","drawGrid","drawVisual","element","playSound","setGameLogic","logic","Sound","CanvasView","view","context","getContext","sounds","images","nextAnimationFrame","window","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","callback","setTimeout","bind","me","render","ctx","sx","wo","ho","dx","mazeCoordinates","dy","w","min","h","drawImage","image","clearRect","maze","fillStyle","fillRect","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","closePath","soundName","loop","volume","audio","sound","isNaN","setVolume","play","loadImages","resources","progress","loadedCount","totalCount","Object","keys","Promise","all","iterable","mapApply","id","resolve","reject","img","Image","addEventListener","Error","recent","total","src","toArray","then","imgs","toObject","loadSounds","Audio","canPlayType","replace","ogg","mp3","loadResources","console","log","loadedImages","loadedSounds","tag","source","value","max","active","channels","createAudio","ended","currentTime","removeEventListener","destroyAudio","enabled","deposit","d","disable","enable","change","Path","list","propagate","pathLength","lastIndex","dir","direction","Base","registerEvent","event","len","unregisterEvent","triggerEvent","args","e","handler","Player","points","setMoney","addMoney","getMoney","setHitpoints","addHitpoints","getHitpoints","unit","damage","GameObject","speed","animationDelay","dead","distanceTo","update","frames","time","delay","getClosestTarget","targets","maximum","closestTarget","dist","Number","MAX_VALUE","target","t","getView","createVisual","imageName","Tower","range","shotType","timeToNextShot","mazeWeight","targetFilter","strategy","shoot","filter","velocity","Unit","mazeStrategy","timer","health","playInitSound","playDeathSound","playVictorySound","s","sigma","Shot","impactRadius","timeToDamagability","GameState","unstarted","building","waving","finished","types","units","towers","shots","GameLogic","maxTowerNumber","player","state","getMazeSize","currentWave","finish","refreshed","current","getNumShooting","gameLoop","setInterval","tick","clearInterval","objects","removeDeadObjects","newUnits","addUnit","getViewSize","getSize","transformCoordinates","screenX","screenY","removeTower","tower","addTower","addShot","unt","removeDead","endWave","prizeMoney","beginWave","wave","waves","next","buildTower","Type","newTower","numShooting","cost","destroyTower","towerToRemove","setWaves","forEach","WaveList","unitNames","Wave","startTime","unitsToSpawn","remaining","Mario","sprite","enemy","description","nickName","Rope","rope","FireWizzrobe","wizz","AirWolf","wolf","DarkNut","nut","Speedy","Armos","armos","StandardShot","std","AirShot","FlameShot","flame","HellShot","hell","IceShot","ice","MGShot","mg","LaserShot","laser","ShellShot","shell","MGNest","nest","CanonTower","canon","FlameTower","IceTower","LaserTower","GateToHell","gate","TowerDefense","static Definition","params","initialize","string","ignore","integer","array","defaultValue","coerce","__maze__","mkPoint","c","mapWidth","mapHeight","creepPath","map","towerPlaces","__waveList__","game","copy","def","object","startMoney","startHP","Iterable","repeat","result","hp","level","__logic__","waveList","gameId","TowerType","fromGameLogic","coord","move","that","future","Future","toString","join","AIPlayer","steps","expansionRate","mutationRate","Problem","objectives","Infinity","call","towerTypes","select","discrete","__elementModel__","mapping","prob","values","v","emblem","m","evaluation","game2","decision","problem","ga","metaheuristics","GeneticAlgorithm","on","nub","newElement","run","best","doWhile","g","g2","scenarios","Test01","Test02","Test03"],"mappings":"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","file":"ludorum-towerdefense.min.js","sourcesContent":["/** Module wrapper and layout.\n*/\nfunction __init__(base, Sermat, inveniemus) { \"use strict\";\n/** Import synonyms */\n\tvar declare = base.declare;\n\t\n/** Library layout. */\n\tvar exports = {};\n\t\n/** See `__epilogue__.js`.\n*/","var Class = exports.Class = (function(){\n\tvar initializing = false,\n\t\tfnTest = /\\b_super\\b/,\n\t\tcls = function Class() {}; // The base Class implementation (does nothing)\n\t\n\t// Create a new Class that inherits from this class\n\tcls.extend = function extend(prop, modifier) {\n\t\tvar _super = this.prototype;\n\n\t\t// Instantiate a base class (but only create the instance, don't run the init constructor)\n\t\tinitializing = true;\n\t\tvar prototype = new this();\n\t\tinitializing = false;\n\t\t \n\t\t// Copy the properties over onto the new prototype\n\t\tfor (var name in prop) {\n\t\t\t// Check if we're overwriting an existing function\n\t\t\tprototype[name] = typeof(prop[name]) === \"function\" && typeof(_super[name]) === \"function\" && fnTest.test(prop[name]) ? (function(name, fn) {\n\t\t\t\treturn function() {\n\t\t\t\t\tvar tmp = this._super;\n\t\t\t\t\t// Add a new ._super() method that is the same method but on the super-class\n\t\t\t\t\tthis._super = _super[name];\n\t\t\t\t\t// The method only need to be bound temporarily, so we remove it when we're done executing\n\t\t\t\t\tvar ret = fn.apply(this, arguments);        \n\t\t\t\t\tthis._super = tmp;\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\t\t\t})(name, prop[name]) : prop[name];\n\t\t}\n\t\t \n\t\t// The dummy class constructor\n\t\tvar Class = function() {\n\t\t\t// All construction is actually done in the init method\n\t\t\tif (!initializing && this.init)\n\t\t\t\tthis.init.apply(this, arguments);\n\t\t};\n\t\t \n\t\t// Populate our constructed prototype object\n\t\tClass.prototype = prototype;\n\t\t \n\t\t// Enforce the constructor to be what we expect\n\t\tClass.prototype.constructor = Class;\n\n\t\t// And make this class extendable\n\t\tClass.extend = this.extend;\n\n\t\t// Use class (for statics or registration)\n\t\tif (modifier && typeof(modifier) === 'function')\n\t\t\tmodifier(Class);\n\t\t \n\t\treturn Class;\n\t};\n\treturn cls;\n})();","/*\n * Global constants\n */\nvar constants = exports.constants = {\n\tticks: 25,\n\tmoney : 99,\n\thitpoints : 10,\n\tmediPackCost : 20,\n\tmediPackFactor : 1,\n\tmediPackHealth : 1,\n\ttowerBuildCost : 5,\n\ttowerBuildFactor : 1,\n\ttowerBuildNumber : 10,\n};\n\n/*\n * A list of possible events\n */\nvar events = exports.events = {\n\tclick: 'click',\n\tmousemove: 'mousemove',\n\tmouseover: 'mouseover',\n\tmouseout: 'mouseout',\n\tcontextmenu: 'contextmenu',\n\tdied: 'died',\n\tshot: 'shot',\n\thit: 'hit',\n\taccomplished : 'accomplished',\n\tplayerDefeated : 'playerDefeated',\n\tmoneyChanged : 'moneyChanged',\n\twaveCreated : 'waveCreated',\n\twaveFinished : 'waveFinished',\n\twaveDefeated : 'waveDefeated',\n\thealthChanged : 'healthChanged',\n\tunitSpawned : 'unitSpawned',\n\ttowerNumberChanged : 'towerNumberChanged',\n};\n\n","/* MazeStrategy ENUM\n */\nvar MazeStrategy = exports.MazeStrategy = {\n\tmanhattan        : 1,\n\tmaxDXDY          : 2,\n\tdiagonalShortCut : 3,\n\teuclidean        : 4,\n\teuclideanNoSQR   : 5,\n\tcustom           : 6,\n\tair              : 7\n};\n\n/* Direction ENUM\n */\nvar Direction = exports.Direction = {\n\tright : 0,\n\ttop : 1,\n\tleft : 2,\n\tbottom : 3,\n};\n\nvar Steps = exports.Steps = {\n\tWithDiagonals : [[0, -1], [1, 0], [0, 1], [-1, 0], [1, -1], [1, 1], [-1, 1], [-1, -1]],\n\tOnlyStraight : [[0, -1], [1, 0], [0, 1], [-1, 0]],\n};\n\n/* Point STRUCT\n */\nvar Point = exports.Point = Class.extend({\n\tinit: function(x, y) {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t},\n\tclone: function() {\n\t\treturn new Point(this.x, this.y);\n\t},\n\tadd: function(pt) {\n\t\treturn new Point(this.x + pt.x, this.y + pt.y);\n\t},\n\tsubtract: function(pt) {\n\t\treturn new Point(this.x - pt.x, this.y - pt.y);\n\t},\n\tprojectOn: function(pt) {\n\t\treturn this.x * pt.x + this.y * pt.y;\n\t},\n\tnorm: function() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t},\n\tsquare: function() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t},\n\tscale: function(factor) {\n\t\treturn new Point(this.x * factor, this.y * factor);\n\t},\n\tnormalize: function() {\n\t\tvar norm = 1.0 / this.norm();\n\t\treturn this.scale(norm);\n\t},\n\tregularize: function() {\n\t\tif (this.x === 0 && this.y === 0)\n\t\t\treturn new Point(2 * Math.round(Math.random()) - 1, 2 * Math.round(Math.random()) - 1);\n\n\t\treturn this;\n\t},\n\ttoDirection: function() {\n\t\tif (this.x > this.y)\n\t\t\treturn this.x > -this.y ? Direction.right : Direction.top;\n\t\telse if (this.x > -this.y)\n\t\t\treturn Direction.bottom;\n\t\treturn Direction.left;\n\t},\n});\n\n/* Size STRUCT\n */\nvar Size = exports.Size = Class.extend({\n\tinit: function(width, height) {\n\t\tthis.width = width || 0;\n\t\tthis.height = height || 0;\n\t},\n\tclone: function() {\n\t\treturn new Size(this.width, this.height);\n\t},\n\tdivide: function(sz) {\n\t\treturn new Size(this.width / sz.width, this.height / sz.height);\n\t}\n});\n\n/* Maze CLASS\n */\nvar Maze = exports.Maze = Class.extend({\n\tinit: function(size, path, turrets) {\n\t\tthis.gridDim = size;\n\t\tvar grid = [];\n\n\t\tfor (var i = 0; i < size.width + 1; i++) {\n\t\t\tvar a = [];\n\n\t\t\tfor (var j = 0; j < size.height; j++)\n\t\t\t\ta.push(1);\n\n\t\t\tgrid.push(a);\n\t\t}\n\n\t\tthis.grid = grid;\n\t\tthis.path = path;\n\t\tthis.start = path[0];\n\t\tthis.end = path[path.length-1];\n\t\tthis.paths = {};\n\t\tthis.turrets = turrets;\n\t},\n\t\n\ttryBuild: function(point, weight) {\n\t\tif (this.grid[point.x][point.y] !== 1)\n\t\t\treturn false;\n\n\t\tfor (var i = 0; i < this.turrets.length; i++) {\n\t\t\tif (this.turrets[i].x == point.x && this.turrets[i].y == point.y) {\n\t\t\t\tthis.grid[point.x][point.y] = weight || 0;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\ttryRemove: function(point) {\n\t\tif (this.grid[point.x][point.y] !== 1) {\n\t\t\tthis.grid[point.x][point.y] = 1;\n\t\t\tthis.paths = {};\n\t\t\treturn true;\n\t\t}\n\t\t\n\t\treturn false;\n\t},\n\tgetPath: function() {\n\t\treturn this.path;\n\t}\n});\n\n","/*\n * The VIEW and implementations of it\n */\nvar View = exports.View = Class.extend({\n\tinit: function(width, height) {\n\t\tthis.running = false;\n\t\tthis.visuals = [];\n\t\tthis.background = undefined;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis.showGrid = true;\n\t\tthis.mazeSize = new Size(25, 25);\n\t},\n\tpause: function() {\n\t\tthis.running = false;\t\n\t},\n\tadd: function(visual) {\n\t\tif (Array.isArray(visual)) {\n\t\t\tfor (var i = 0, n = visual.length; i < n; ++i)\n\t\t\t\tthis.visuals.push(visual[i]);\n\t\t} else\n\t\t\tthis.visuals.push(visual);\n\n\t\tthis.visuals.sort(function(a, b) {\n\t\t\treturn a.z - b.z;\n\t\t});\n\t},\n\tremove: function(visual) {\n\t\tvar index = this.visuals.indexOf(visual);\n\t\tthis.visuals.splice(index, 1);\n\t},\n\tdraw: function() {\n\t\tthis.drawBackground();\n\t\tthis.drawSpawn();\n\t\tthis.drawHome();\n\t\tthis.drawPath();\n\t\tthis.drawTurrets();\n\n\t\tif (this.showGrid)\n\t\t\tthis.drawGrid();\n\n\t\tfor (var i = 0, n = this.visuals.length; i < n; ++i)\n\t\t\tthis.drawVisual(this.visuals[i]);\n\t},\n\tdrawBackground: function() {\n\t},\n\tdrawGrid: function() {\n\t},\n\tdrawHome: function() {\n\t},\n\tdrawSpawn: function() {\n\t},\n\tdrawPath: function() {\n\t},\n\tdrawTurrets: function() {\n\t},\n\tdrawVisual: function(element) {\n\t},\n\tplaySound: function() {\n\t},\n\tstart: function(){\n\t},\n\tsetGameLogic: function(logic) {\n\t\tthis.logic = logic;\n\t},\n});\n\n/*\n * The implementation for the canvas element\n */\nvar CanvasView = exports.CanvasView = View.extend({\n\tinit: function(element) {\n\t\tthis._super(element.width, element.height);\n\t\tthis.view = element;\n\t\tthis.context = element.getContext('2d');\n\t\tthis.sounds = {};\n\t\tthis.images = {};\n\t\t\n\t\tthis.nextAnimationFrame = (window.requestAnimationFrame || window.webkitRequestAnimationFrame || \n\t\t\twindow.mozRequestAnimationFrame || window.oRequestAnimationFrame || \n\t\t\twindow.msRequestAnimationFrame || function(callback) {\n\t\t\t\twindow.setTimeout(callback, 1000 / constants.ticks);\n\t\t\t}\n\t\t).bind(window);\n\t},\n\n\tstart: function() {\n\t\tvar me = this;\n\t\tme.running = true;\n\t\tvar render = function() {\n\t\t\tif (me.running)\n\t\t\t\tme.nextAnimationFrame(render);\n\t\t\tme.draw();\n\t\t};\n\t\tme.nextAnimationFrame(render);\n\t},\n\n\tdrawVisual: function(element) {\n\t\tvar ctx = this.context;\n\t\tvar visual = element.visual;\n\t\tvar sx = visual.index * visual.width;\n\t\tvar sy = 0;\n\t\tvar wo = this.width / this.mazeSize.width;\n\t\tvar ho = this.height / this.mazeSize.height;\n\t\tvar dx = element.mazeCoordinates.x * wo;\n\t\tvar dy = element.mazeCoordinates.y * ho;\n\t\tvar w = visual.scale * wo * Math.min(1, visual.width / visual.height);\n\t\tvar h = visual.scale * ho * Math.min(1, visual.height / visual.width);\n\t\tdx += (wo - w) * 0.5;\n\t\tdy += (ho - h) * 0.5;\n\t\tctx.drawImage(visual.image, sx, sy, visual.width, visual.height, dx, dy, w, h);\n\t},\n\n\tdrawBackground: function() {\n\t\tvar ctx = this.context;\n\t\tctx.clearRect(0, 0, this.width, this.height);\n\n\t\tif (this.background)\n\t\t\tctx.drawImage(this.background, 0, 0, this.width, this.height);\n\t},\n\n\tdrawHome: function() {\n\t\tvar ctx = this.context;\n\t\tvar width = this.width / this.mazeSize.width;\n\t\tvar height = this.height / this.mazeSize.height;\n\t\tvar path = this.logic.maze.path;\n\t\tvar x = path[path.length-1].x * width;\n\t\tvar y = path[path.length-1].y * height;\n\t\tctx.fillStyle = 'rgba(0, 255, 0, 0.7)';\n\t\tctx.fillRect(x, y, width, height);\n\t},\n\n\tdrawSpawn: function() {\n\t\tvar ctx = this.context;\n\t\tvar width = this.width / this.mazeSize.width;\n\t\tvar height = this.height / this.mazeSize.height;\n\t\tvar path = this.logic.maze.path;\n\t\tvar x = path[0].x * width;\n\t\tvar y = path[0].y * height;\n\t\tctx.fillStyle = 'rgba(255, 0, 0, 0.7)';\n\t\tctx.fillRect(x, y, width, height);\n\t},\n\n\tdrawGrid: function() {\n\t\tvar ctx = this.context;\n\t\tctx.strokeStyle = 'rgba(0, 0, 0, 0.4)';\n\t\tctx.lineWidth = 0.8;\n\n\t\tfor (var i = 1, w = this.mazeSize.width; i < w; ++i) {\n\t\t\tvar x = i * this.width / w;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x, 0);\n\t\t\tctx.lineTo(x, this.height);\n\t\t\tctx.stroke();\n\t\t\tctx.closePath();\n\t\t}\n\t\t\n\t\tfor (var j = 1, h = this.mazeSize.height; j < h; ++j) {\n\t\t\tvar y = j * this.height / h;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(0, y);\n\t\t\tctx.lineTo(this.width, y);\n\t\t\tctx.stroke();\n\t\t\tctx.closePath();\n\t\t}\n\t},\n\n\tdrawPath: function() {\n\t\tvar ctx = this.context;\n\t\tvar width = this.width / this.mazeSize.width;\n\t\tvar height = this.height / this.mazeSize.height;\n\t\tvar path = this.logic.maze.path;\n\t\tfor (var i = 0; i < path.length; i++) {\n\t\t\tvar x = path[i].x * width;\n\t\t\tvar y = path[i].y * height;\n\t\t\tctx.fillStyle = 'rgba(20, 20, 20, 0.6)';\n\t\t\tctx.fillRect(x, y, width, height);\n\t\t}\n\t},\n\t\n\tdrawTurrets: function() {\n\t\tvar ctx = this.context;\n\t\tvar width = this.width / this.mazeSize.width;\n\t\tvar height = this.height / this.mazeSize.height;\n\t\tvar turrets = this.logic.maze.turrets;\n\t\tfor (var i = 0; i < turrets.length; i++) {\n\t\t\tvar x = turrets[i].x * width;\n\t\t\tvar y = turrets[i].y * height;\n\t\t\tctx.fillStyle = 'rgba(20, 20, 200, 0.6)';\n\t\t\tctx.fillRect(x, y, width, height);\n\t\t}\n\t},\n\n\tplaySound: function(soundName, loop, volume) {\n\t\tvar audio = this.sounds[soundName];\n\t\tvar sound = new Sound(audio, loop);\n\t\tif (!isNaN(volume))\n\t\t\tsound.setVolume(volume);\n\t\tsound.play();\n\t},\n\n\tloadImages: function loadImages(resources, progress) {\n\t\tvar loadedCount = 0,\n\t\t\ttotalCount = Object.keys(resources).length;\n\t\treturn Promise.all(base.iterable(resources).mapApply(function (id, path) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar img = new Image();\n\t\t\t\timg.addEventListener('error', function () {\n\t\t\t\t\treject(new Error('Loading image '+ id +' ('+ path +') failed!'));\n\t\t\t\t}, false);\n\t\t\t\timg.addEventListener('load', function () {\n\t\t\t\t\tloadedCount++;\n\t\t\t\t\tif (progress) {\n\t\t\t\t\t\tprogress({\n\t\t\t\t\t\t\tname: 'images',\n\t\t\t\t\t\t\trecent: id,\n\t\t\t\t\t\t\ttotal: totalCount,\n\t\t\t\t\t\t\tprogress: loadedCount / totalCount\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve([id, img]);\n\t\t\t\t}, false);\n\t\t\t\timg.src = path;\n\t\t\t});\n\t\t}).toArray()).then(function (imgs) {\n\t\t\treturn base.iterable(imgs).toObject();\n\t\t});\n\t},\n\n\tloadSounds: function loadSounds(resources, progress) {\n\t\tvar loadedCount = 0,\n\t\t\ttotalCount = Object.keys(resources).length;\n\t\treturn Promise.all(base.iterable(resources).mapApply(function (id, path) {\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar sound = new Audio();\n\t\t\t\tsound.addEventListener('error', function() {\n\t\t\t\t\treject(new Error('Loading sound '+ id +' ('+ path +') failed!'));\n\t\t\t\t}, false);\n\t\t\t\tsound.addEventListener('loadedmetadata', function() {\n\t\t\t\t\tloadedCount++;\n\t\t\t\t\tif (progress) {\n\t\t\t\t\t\tprogress({\n\t\t\t\t\t\t\tname: 'sounds',\n\t\t\t\t\t\t\trecent: id,\n\t\t\t\t\t\t\ttotal: totalCount,\n\t\t\t\t\t\t\tprogress: loadedCount / totalCount\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tresolve([id, sound]);\n\t\t\t\t}, false);\n\t\t\t\t\n\t\t\t\tif (sound.canPlayType('audio/ogg').replace(/^no$/, '') && path.ogg) {\n\t\t\t\t\tsound.src = path.ogg;\n\t\t\t\t} else if (sound.canPlayType('audio/mpeg').replace(/^no$/, '') && path.mp3) {\n\t\t\t\t\tsound.src = path.mp3;\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('Browser does not support the available audio types!'));\n\t\t\t\t}\n\t\t\t});\n\t\t}).toArray()).then(function (imgs) {\n\t\t\treturn base.iterable(imgs).toObject();\n\t\t});\n\t},\n\n\tloadResources: function(images, sounds, progress) {\n\t\tvar view = this;\n\t\tconsole.log(\"Loading resources...\");//FIXME\n\t\treturn view.loadImages(images, progress).then(function (loadedImages) {\n\t\t\tconsole.log(\"Loaded images...\");//FIXME\n\t\t\tview.images = loadedImages;\n\t\t\treturn view.loadSounds(sounds, progress).then(function (loadedSounds) {\n\t\t\t\tconsole.log(\"Loaded sounds.\");//FIXME\n\t\t\t\tview.sounds = loadedSounds;\n\t\t\t});\n\t\t});\n\t}\n});","/*\n * The Sound class\n */\nvar Sound = exports.Sound = Class.extend({\n\tinit: function(tag, loop) {\n\t\tthis.source = tag.src;\n\t\tthis.loop = !!loop;\n\t\tthis.setVolume(1.0);\n\t},\n\tsetVolume: function(value) {\n\t\tthis.volume = Math.max(0, Math.min(1, value));\n\n\t\tif (this.element)\n\t\t\tthis.element.volume = Sound.volume * this.volume;\n\t},\n\tplay: function() {\n\t\tif (this.element || Sound.active > Sound.channels)\n\t\t\treturn;\n\n\t\tvar me = this;\n\t\tme.element = Sound.createAudio(this.source);\n\t\tme.setVolume(me.volume);\n\t\tvar ended = function() {\n\t\t\tif (me.loop) {\n\t\t\t\tthis.currentTime = 0;\n\t\t\t\tthis.play();\n\t\t\t} else {\n\t\t\t\tme.element = undefined;\n\t\t\t\tthis.removeEventListener('ended', ended);\n\t\t\t\tSound.destroyAudio(this);\n\t\t\t}\n\t\t};\n\n\t\tme.element.addEventListener('ended', ended);\n\n\t\tif (Sound.enabled)\n\t\t\tme.element.play();\n\t},\n}, function(sounds) {\n\tvar deposit = [];\n\tsounds.volume = 1.0;\n\tsounds.channels = 6;\n\tsounds.active = 0;\n\tsounds.sounds = [];\n\tsounds.enabled = true;\n\tsounds.createAudio = function(src) {\n\t\tvar d;\n\t\tsounds.active++;\n\n\t\tfor (var i = deposit.length; i--; ) {\n\t\t\td = deposit[i];\n\n\t\t\tif (!d.active && d.src === src) {\n\t\t\t\td.active = true;\n\t\t\t\td.element.currentTime = 0;\n\t\t\t\treturn d.element;\n\t\t\t}\n\t\t}\n\n\t\td = {\n\t\t\tactive:true,\n\t\t\tsrc:src,\n\t\t\telement:new Audio(src),\n\t\t};\n\t\tdeposit.push(d);\n\t\treturn d.element;\n\t};\n\tsounds.destroyAudio = function(element) {\n\t\tsounds.active--;\n\n\t\tfor (var i = deposit.length; i--; ) {\n\t\t\tif (deposit[i].element === element) {\n\t\t\t\tdeposit[i].active = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\tsounds.disable = function() {\n\t\tif (sounds.enabled) {\n\t\t\tsounds.enabled = false;\n\n\t\t\tfor (var i = deposit.length; i--; ) {\n\t\t\t\tif (deposit[i].active)\n\t\t\t\t\tdeposit[i].element.pause();\n\t\t\t}\n\t\t}\n\t};\n\tsounds.enable = function() {\n\t\tif (!sounds.enabled) {\n\t\t\tsounds.enabled = true;\n\n\t\t\tfor (var i = deposit.length; i--; ) {\n\t\t\t\tif (deposit[i].active)\n\t\t\t\t\tdeposit[i].element.play();\n\t\t\t}\n\t\t}\n\t};\n\tsounds.setVolume = function(volume) {\n\t\tvolume = Math.min(Math.max(volume, 0), 1);\n\t\tvar change = volume / sounds.volume;\n\t\tsounds.volume = volume;\n\n\t\tfor (var i = deposit.length; i--; )\n\t\t\tdeposit[i].element.volume = change * deposit[i].element.volume;\n\t};\n});","/*\n * The available images\n */\n//var images = exports.images = {};\n\n/*\n * The available sounds\n */\n//var sounds = exports.sounds = {};\n\n/*\n * The path\n */\nvar Path = exports.Path = Class.extend({\n\tinit: function(list) {\n\t\tthis.list = list;\n\t},\n\tpropagate: function(pathLength) {\n\t\tvar lastIndex = ~~pathLength;\n\t\tvar dir = Direction.bottom;\n\n\t\tif (lastIndex + 1 >= this.list.length)\n\t\t\treturn false;\n\n\t\tif (this.list[lastIndex].x < this.list[lastIndex + 1].x)\n\t\t\tdir = Direction.right;\n\t\telse if (this.list[lastIndex].x > this.list[lastIndex + 1].x)\n\t\t\tdir = Direction.left;\n\t\telse if (this.list[lastIndex].y > this.list[lastIndex + 1].y)\n\t\t\tdir = Direction.top;\n\n\t\tvar point = this.list[lastIndex + 1].subtract(this.list[lastIndex]);\n\t\tpoint = point.scale(pathLength - lastIndex);\n\t\tpoint = this.list[lastIndex].add(point);\n\n\t\treturn {\n\t\t\tpoint: point,\n\t\t\tdirection: dir,\n\t\t};\n\t},\n});\n\n/*\n * The base for classes with events \n */\nvar Base = exports.Base = Class.extend({\n\tinit: function() {\n\t\tthis.events = {};\n\t},\n\tregisterEvent: function() {\n\t\tvar len = arguments.length, \n\t\t\ti, event;\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tevent = arguments[i];\n\t\t\tif (!this.events[event]) {\n\t\t\t\tthis.events[event] = [];\n\t\t\t}\n\t\t}\n\t},\n\tunregisterEvent: function() {\n\t\tvar len = arguments.length;\n\t\tfor (var i = 0; i < len; i++) {\n\t\t\tdelete this.events[arguments[i]];\n\t\t}\n\t},\n\ttriggerEvent: function(event, args) {\n\t\tif (this.events[event]) {\n\t\t\tvar e = this.events[event];\n\n\t\t\tfor (var i = e.length; i--; )\n\t\t\t\te[i].apply(this, [args || {}]);\n\t\t}\n\t},\n\taddEventListener: function(event, handler) {\n\t\tif (this.events[event] && handler && typeof(handler) === 'function')\n\t\t\tthis.events[event].push(handler);\n\t},\n\tremoveEventListener: function(event, handler) {\n\t\tif (this.events[event]) {\n\t\t\tif (handler && typeof(handler) === 'function') {\n\t\t\t\tvar index = this.events[event].indexOf(handler);\n\t\t\t\tthis.events[event].splice(index, 1);\n\t\t\t} else\n\t\t\t\tthis.events[event].splice(0, this.events[event].length);\n\t\t}\n\t},\n});\n\n/*\n * The player class\n */\nvar Player = exports.Player = Base.extend({ \n\tinit: function(name) {\n\t\tthis._super();\n\t\tthis.name = name || 'Player';\n\t\tthis.money = 0;\n\t\tthis.points = 0;\n\t\tthis.hitpoints = 0;\n\t\tthis.registerEvent(events.playerDefeated, events.moneyChanged, events.healthChanged);\n\t},\n\tsetMoney: function(value) {\n\t\tthis.money = value;\n\t\tthis.triggerEvent(events.moneyChanged, this);\n\t},\n\taddMoney: function(value) {\n\t\tthis.points += Math.max(0, value);\n\t\tthis.setMoney(this.money + value);\n\t},\n\tgetMoney: function() {\n\t\treturn this.money;\n\t},\n\tsetHitpoints: function(value) {\n\t\tthis.hitpoints = Math.max(0, value);\n\t\tthis.triggerEvent(events.healthChanged, this);\n\n\t\tif (this.hitpoints === 0)\n\t\t\tthis.triggerEvent(events.playerDefeated, this);\n\t},\n\taddHitpoints: function(value) {\n\t\tthis.setHitpoints(this.hitpoints + value);\n\t},\n\tgetHitpoints: function() {\n\t\treturn this.hitpoints;\n\t},\n\thit: function(unit) {\n\t\tthis.setHitpoints(this.hitpoints - unit.damage);\n\t},\n});\n\n/*\n * The base for game objects (units, towers, shots)\n */\nvar GameObject = exports.GameObject = Base.extend({\n\tinit: function(logic, speed, animationDelay) {\n\t\tthis._super();\n\t\tthis.z = 0;\n\t\t// ACA\n\t\t// ARREGLAR\n\t\t// POR QUÉ?\n\t\tthis.mazeCoordinates = new Point();\n\t\tthis.speed = speed || 0;\n\t\tthis.animationDelay = animationDelay || 15;\n\t\tthis.dead = false;\n\t\tthis.direction = Direction.right;\n\t\tthis.logic = logic;\n\t},\n\tdistanceTo: function(point) {\n\t\treturn point.subtract(this.mazeCoordinates).norm();\n\t},\n\tupdate: function() {\n\t\tvar visual = this.visual;\n\t\tif (visual) {\n\t\t\tvar direction = visual.frames.length === 4 ? this.direction : 0;\n\t\t\tvisual.time += constants.ticks;\n\t\t\tvar i;\n\n\t\t\tif (visual.direction !== this.direction) {\n\t\t\t\tvisual.direction = this.direction;\n\t\t\t\tvisual.time = 0;\n\t\t\t\tvisual.index = 0;\n\n\t\t\t\tfor (i = 0; i < direction; ++i)\n\t\t\t\t\tvisual.index += visual.frames[i];\n\t\t\t} else if (visual.delay < visual.time) {\n\t\t\t\tvar frames = 0;\n\t\t\t\tvar index = 0;\n\t\t\t\tvisual.index++;\n\t\t\t\tvisual.time = 0;\n\n\t\t\t\tfor (i = 0; i < direction; ++i)\n\t\t\t\t\tindex += visual.frames[i];\n\n\t\t\t\tif (visual.index === index + visual.frames[direction])\n\t\t\t\t\tvisual.index = index;\n\t\t\t}\n\t\t}\n\t},\n\tgetClosestTarget: function(targets, maximum) {\n\t\tvar closestTarget;\n\t\tvar dist = Number.MAX_VALUE;\n\n\t\tfor (var i = targets.length; i--; ) {\n\t\t\tvar target = targets[i];\n\t\t\tvar t = this.distanceTo(target.mazeCoordinates);\n\n\t\t\tif (t < dist) {\n\t\t\t\tclosestTarget = target;\n\t\t\t\tdist = t;\n\t\t\t}\n\t\t}\n\n\t\tif (dist <= maximum)\n\t\t\treturn closestTarget;\n\t},\n\tplaySound: function(soundName) {\n\t\t/*var audio = sounds[soundName];\n\t\tvar sound = new Sound(audio);\n\t\tsound.play();*/\n\t\tvar view = this.logic && this.logic.getView();\n\t\tif (view) {\n\t\t\tview.playSound(soundName);\n\t\t}\n\t},\n\tcreateVisual: function(imageName, frames, scale) {\n\t\tvar total = 0;\n\t\tvar index = 0;\n\t\tvar view = this.logic.getView();\n\t\tvar image = view.images && view.images[imageName];\n\t\t\n\t\tif (image) {\n\t\t\tfor (var i = frames.length; i--; ) {\n\t\t\t\ttotal += frames[i];\n\n\t\t\t\tif (i < this.direction)\t\n\t\t\t\t\tindex += frames[i];\n\t\t\t}\n\n\t\t\tif (frames.length === 1)\n\t\t\t\tindex = 0;\n\n\t\t\tthis.visual = {\n\t\t\t\tdirection : this.direction,\n\t\t\t\tindex : index,\n\t\t\t\ttime : 0,\n\t\t\t\tlength : total,\n\t\t\t\tframes : frames,\n\t\t\t\timage : image,\n\t\t\t\tdelay : this.animationDelay,\n\t\t\t\twidth : image.width / total,\n\t\t\t\theight: image.height,\n\t\t\t\tscale : scale || 1,\n\t\t\t};\n\t\t}\n\t},\n\t/*setGameLogic: function(logic) {\n\t\tthis.logic = logic;\n\t},*/\n});\n\n/*\n * The tower base\n */\nvar Tower = exports.Tower = GameObject.extend({\n\tinit: function(logic, speed, animationDelay, range, shotType) {\n\t\tthis._super(logic, speed, animationDelay);\n\t\tthis.range = range || 0;\n\t\tthis.targets = [];\n\t\tthis.timeToNextShot = 0;\n\t\tthis.mazeWeight = 0;\n\t\tthis.direction = Direction.left;\n\t\tthis.shotType = shotType || {};\n\t\tthis.registerEvent(events.shot);\n\t},\n\ttargetFilter: function(target) {\n\t\treturn target.strategy !== MazeStrategy.air;\n\t},\n\tupdate: function() {\n\t\tthis._super(this.logic);\n\t\tvar shot;\n\n\t\tif (this.timeToNextShot <= 0)\n\t\t\tshot = this.shoot();\n\t\t\n\t\tif (shot) {\n\t\t\tthis.triggerEvent(events.shot, shot);\n\t\t\tthis.timeToNextShot = ~~(1000 / this.speed);\n\t\t} else\n\t\t\tthis.timeToNextShot -= constants.ticks;\n\t},\n\tshoot: function() {\n\t\tvar targets = this.targets.filter(this.targetFilter);\n\t\tvar closestTarget = this.getClosestTarget(targets, this.range);\n\n\t\tif (closestTarget) {\n\t\t\tvar shot = new (this.shotType)(this.logic);\n            shot.mazeCoordinates = this.mazeCoordinates;\n            shot.velocity = closestTarget.mazeCoordinates.subtract(this.mazeCoordinates);\n            shot.direction = shot.velocity.toDirection();\n            shot.targets = targets;\n            this.direction = shot.direction;\n            return shot;\n\t\t}\n\t},\n});\n\n/*\n * The unit base\n */\nvar Unit = exports.Unit = GameObject.extend({\n \tinit: function(logic, speed, animationDelay, mazeStrategy, hitpoints) {\n\t\tthis._super(logic, speed, animationDelay);\n \t\tthis.timer = 0;\n \t\tthis.path = new Path([]);\n \t\tthis.mazeCoordinates = new Point();\n \t\tthis.damage = 1;\n \t\tthis.strategy = mazeStrategy || MazeStrategy.air;\n \t\tthis.hitpoints = hitpoints || 0;\n \t\tthis.health = this.hitpoints;\n \t\tthis.direction = Direction.right;\n \t\tthis.registerEvent(events.accomplished, events.died);\n \t},\n \tplayInitSound: function() {\n\t\tthis.playSound('humm');\n \t},\n \tplayDeathSound: function() {\n \t\tthis.playSound('explosion');\n \t},\n \tplayVictorySound: function() {\n\t\tthis.playSound('laugh');\n \t},\n \tupdate: function() {\n \t\tthis._super(this.logic);\n \t\tthis.timer += constants.ticks;\n \t\tvar s = this.speed * 0.001;\n\n \t\tif (!this.dead && s > 0) {\n \t\t\tvar sigma = this.path.propagate(s * this.timer);\n\n \t\t\tif (!sigma) {\n \t\t\t\tthis.dead = true;\n \t\t\t\tthis.triggerEvent(events.accomplished, this);\n \t\t\t\tthis.playVictorySound();\n \t\t\t} else {\n \t\t\t\tthis.mazeCoordinates = sigma.point;\n \t\t\t\tthis.direction = sigma.direction;\n \t\t\t}\n \t\t}\n \t},\n \thit: function(shot) {\n \t\tthis.health -= shot.damage;\n\n \t\tif (!this.dead && this.health <= 0) {\n \t\t\tthis.health = 0;\n \t\t\tthis.dead = true;\n \t\t\tthis.triggerEvent(events.died, this);\n \t\t\tthis.playDeathSound();\n \t\t}\n \t},\n });\n\n/*\n * The shot base\n */\nvar Shot = exports.Shot = GameObject.extend({\n\tinit: function(logic, speed, animationDelay, damage, impactRadius) {\n\t\tthis._super(logic, speed, animationDelay);\n\t\tthis.damage = damage || 0;\n\t\tthis.targets = [];\n\t\tthis.impactRadius = impactRadius || 0.5;\n\t\tthis.timeToDamagability = ~~(200 / this.speed);\n\t\tthis.velocity = new Point();\n\t\tthis.registerEvent(events.hit);\n\t},\n\tupdate: function() {\n\t\tvar pt = this.velocity.scale(this.speed * constants.ticks * 0.001);\n\t\tthis.mazeCoordinates = this.mazeCoordinates.add(pt);\n\t\tthis._super(this.logic);\n\n\t\tif (this.timeToDamagability > 0) {\n\t\t\tthis.timeToDamagability -= constants.ticks;\n\t\t} else {\n\t\t\tvar closestTarget = this.getClosestTarget(this.targets, this.impactRadius);\n\t\t\t\n\t\t\tif (closestTarget) {\n\t\t\t\tclosestTarget.hit(this);\n\t\t\t\tthis.dead = true;\n\t\t\t\tthis.triggerEvent(events.hit, closestTarget);\n\t\t\t}\n\t\t}\n\t},\n});","/*\n * The gamestate enumeration\n */\nvar GameState = exports.GameState = {\n\tunstarted : 0,\n\tbuilding : 1,\n\twaving : 2,\n\tfinished : 3,\n};\n\n/* \n * Global objects\n */\nvar types = exports.types = {\n\tunits : {},\n\ttowers : {},\n\tshots : {},\n};\n\n/*\n * The GAME\n */\nvar GameLogic = exports.GameLogic = Base.extend({\n\tinit: function(view, maze) {\n\t\tvar me = this;\n\t\tme._super();\n\n\t\tme.towers = [];\n\t\tme.units  = [];\n\t\tme.shots  = [];\n\n\t\tme.mediPackCost     = constants.mediPackCost;\n\t\tme.mediPackFactor   = constants.mediPackFactor;\n\t\tme.towerBuildCost   = constants.towerBuildCost;\n\t\tme.towerBuildFactor = constants.towerBuildFactor;\n\t\tme.maxTowerNumber   = constants.towerBuildNumber;\n\t\tme.mediPackHealth   = constants.mediPackHealth;\n\n\t\tme.view          = view;\n\t\tme.player        = new Player();\n\t\tme.state         = GameState.unstarted;\n\t\tme.maze          = maze;\n\t\tme.view.mazeSize = me.getMazeSize();\n\t\tme.currentWave   = null;\n\t\tme.view.setGameLogic(me);\n\n\t\tme.player.addEventListener(events.playerDefeated, function(e) {\n\t\t\tme.triggerEvent(events.playerDefeated, e);\n\t\t\tme.finish();\n\t\t});\n\n\t\tme.player.addEventListener(events.moneyChanged, function(e) {\n\t\t\tme.triggerEvent(events.moneyChanged, e);\n\t\t});\n\n\t\tme.player.addEventListener(events.healthChanged, function(e) {\n\t\t\tme.triggerEvent(events.healthChanged, e);\n\t\t});\n\n\t\tme.registerEvent(events.refreshed, events.waveDefeated, events.waveFinished, \n\t\t\tevents.playerDefeated, events.moneyChanged, events.healthChanged, \n\t\t\tevents.waveCreated, events.unitSpawned, events.towerNumberChanged);\n\t},\n\tstart: function() {\n\t\tif (this.state === GameState.unstarted) {\n\t\t\tthis.player.setHitpoints(constants.hitpoints);\n\t\t\tthis.player.setMoney(constants.money);\n\t\t\tthis.triggerEvent(events.towerNumberChanged, {\n\t\t\t\tcurrent: this.getNumShooting(),\n\t\t\t\tmaximum: this.maxTowerNumber,\n\t\t\t});\n\t\t\tthis.state = GameState.building;\n\t\t}\n\n\t\tif (!this.gameLoop) {\n\t\t\tvar me = this;\n\t\t\tthis.view.start();\n\t\t\tthis.gameLoop = setInterval(function() {\n\t\t\t\tme.tick();\n\t\t\t}, constants.ticks);\t\n\t\t}\n\t},\n\tpause: function() {\n\t\tif (this.gameLoop) {\n\t\t\tthis.view.pause();\n\t\t\tclearInterval(this.gameLoop);\n\t\t\tthis.gameLoop = undefined;\t\n\t\t}\n\t},\n\tupdate: function(objects) {\n\t\tfor (var i = objects.length; i--; )\n\t\t\tobjects[i].update();\n\t},\n\ttick: function() {\n\t\tif (this.state !== GameState.building && this.state !== GameState.waving)\n\t\t\treturn;\n\t\tthis.update(this.towers);\n\n\t\tif (this.state === GameState.waving) {\n\t\t\tthis.update(this.shots);\n\t\t\tthis.update(this.units);\n\t\t\tthis.removeDeadObjects();\n\t\t\tvar newUnits = this.currentWave.update();\n\n\t\t\tfor (var i = newUnits.length; i--; ) {\n\t\t\t\tvar unit = newUnits[i];\n\t\t\t\tvar path = this.maze.getPath();\n\t\t\t\tunit.mazeCoordinates = this.maze.start;\n\t\t\t\tunit.path = new Path(path);\n\t\t\t\tthis.addUnit(unit);\n\t\t\t}\n\t\t}\n\t},\n\tfinish: function() {\n\t\tthis.state = GameState.finished;\n\t},\n\tgetViewSize: function() {\n\t\treturn this.view.getSize();\n\t},\n\tgetNumShooting: function() {\n\t\treturn this.towers.length;\n\t},\n\tgetMazeSize: function() {\n\t\treturn this.maze.gridDim;\n\t},\n\ttransformCoordinates: function(screenX, screenY) {\n\t\tvar x = screenX * this.maze.gridDim.width / this.view.width;\n\t\tvar y = screenY * this.maze.gridDim.height / this.view.height;\n\t\treturn new Point(~~x, ~~y);\n\t},\n\tremoveTower: function(tower) {\n\t\ttower.removeEventListener(events.shot);\n\t\tthis.towers.splice(this.towers.indexOf(tower), 1);\n\t\tthis.view.remove(tower);\n\t},\n\taddTower: function(tower) {\n\t\tvar me = this;\n\t\ttower.addEventListener(events.shot, function(shot) {\n\t\t\tme.addShot(shot);\n\t\t});\n\t\tme.towers.push(tower);\n\t\tme.view.add(tower);\n\t},\n\taddShot: function(shot) {\n\t\tthis.shots.push(shot);\n\t\tthis.view.add(shot);\n\t\tshot.playInitSound();\n\t},\n\taddUnit: function(unit) {\n\t\tvar me = this;\n\t\tunit.addEventListener(events.accomplished, function(unt) {\n\t\t\tme.player.hit(unt);\n\t\t});\n\t\tunit.playInitSound();\n\t\tme.units.push(unit);\n\t\tme.view.add(unit);\n\t},\n\tremoveDead: function(objects) {\n\t\tfor (var i = objects.length; i--; ) {\n\t\t\tif (objects[i].dead) {\n\t\t\t\tthis.view.remove(objects[i]);\n\t\t\t\tobjects.splice(i, 1);\n\t\t\t}\n\t\t}\n\t},\n\tremoveDeadObjects: function() {\n\t\tthis.removeDead(this.towers);\n\t\tthis.removeDead(this.shots);\n\t\tthis.removeDead(this.units);\n\n\t\tif (this.currentWave.finished && this.units.length === 0)\n\t\t\tthis.endWave();\n\t},\n\tendWave: function() {\n\t\tthis.player.addMoney(this.currentWave.prizeMoney);\n\t\tthis.state = GameState.building;\n\n\t\tfor (var i = this.shots.length; i--; ) {\n\t\t\tthis.view.remove(this.shots[i]);\n\t\t\tthis.shots.splice(i, 1);\n\t\t}\n\n\t\tthis.triggerEvent(events.waveDefeated, this.player);\n\t},\n\tbeginWave: function() {\n\t\tif (this.state === GameState.building) {\n\t\t\tvar me = this;\n\t\t\tme.state = GameState.waving;\n\t\t\tvar wave = me.waves.next();\n\t\t\twave.addEventListener(events.waveFinished, function() {\n\t\t\t\tme.triggerEvent(events.waveFinished);\n\t\t\t\twave.removeEventListener(events.waveFinished);\n\t\t\t\twave.removeEventListener(events.unitSpawned);\n\t\t\t});\n\t\t\twave.addEventListener(events.unitSpawned, function(e) {\n\t\t\t\tme.triggerEvent(events.unitSpawned, e);\n\t\t\t});\n\t\t\tme.triggerEvent(events.waveCreated, wave);\n\t\t\tme.currentWave = wave;\n\t\t}\n\t},\n\tbuildTower: function(pt, Type) {\n\t\tvar newTower = new Type(this);\n\t\tvar numShooting = this.getNumShooting();\n\t\tif (this.state === GameState.building && Type.cost <= this.player.money && (numShooting < this.maxTowerNumber)) {\n\t\t\tnewTower.mazeCoordinates = pt;\n\t\t\tnewTower.cost = Type.cost;\n\t\t\tnewTower.targets = this.units;\n\n\t\t\tif (this.maze.tryBuild(pt, newTower.mazeWeight)) {\n\t\t\t\tthis.player.addMoney(-Type.cost);\n\t\t\t\tthis.addTower(newTower);\n\n\t\t\t\t\n\t\t\t\tthis.triggerEvent(events.towerNumberChanged, {\n\t\t\t\t\tcurrent: numShooting + 1,\n\t\t\t\t\tmaximum: this.maxTowerNumber,\n\t\t\t\t});\t\n\t\t\t\t\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\tdestroyTower: function(pt) {\n\t\tif (this.state == GameState.building) {\n\t\t\tvar towerToRemove = this.towers.filter(function(t) {\n\t\t\t\treturn t.mazeCoordinates.x === pt.x && t.mazeCoordinates.y === pt.y;\n\t\t\t})[0];\n\n\t\t\tif (towerToRemove) {\n\t\t\t\tthis.player.addMoney(0.5 * towerToRemove.cost);\n\t\t\t\tthis.removeTower(towerToRemove);\n\t\t\t\tthis.maze.tryRemove(pt);\n\n\t\t\t\t\n\t\t\t\tthis.triggerEvent(events.towerNumberChanged, {\n\t\t\t\t\tcurrent: this.getNumShooting(),\n\t\t\t\t\tmaximum: this.maxTowerNumber,\n\t\t\t\t});\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t},\n\tgetView: function() {\n\t\tvar view = this.view;\n\t\treturn view;\n\t},\n\tsetWaves: function(waves) {\n\t\tvar logic = this;\n\t\tthis.waves = waves;\n\t\tif (waves) {\n\t\t\twaves.waves.forEach(function (w) {\n\t\t\t\tw.logic = logic;\n\t\t\t});\n\t\t}\n\t\treturn this;\n\n\t\t// var logic = (new GameLogic(..)).setWaves(..)\n\t}\n});\n\n/*\n * The WAVELIST\n */\nvar WaveList = exports.WaveList = Class.extend({\n\tinit: function(waves) {\n\t\tthis.waves = waves;\n\t\tthis.index = 0;\n\t\tthis.unitNames = Object.keys(types.units);\n\t},\n\n\tnext: function() {\n\t\tif (this.index < this.waves.length)\n\t\t\treturn this.waves[this.index++];\n\t},\n\t\n\tsetGameLogic: function(logic) {\n\t\tthis.logic = logic;\n\t},\n});\n\n/*\n * The WAVE\n */\nvar Wave = exports.Wave = Base.extend({\n\tinit: function(logic, prizeMoney, units) {\n\t\tthis._super();\n\t\tthis.startTime = 0;\n\t\tthis.units = units || [];\n\t\tthis.prizeMoney = prizeMoney || 0;\n\t\tthis.finished = false;\n\t\tthis.registerEvent(events.unitSpawned, events.waveFinished);\n\t\tthis.logic = logic;\n\t},\n\tadd: function(unit, time) {\n\t\tthis.units.push({\n\t\t\ttime: time,\n\t\t\tunit: unit\n\t\t});\n\t},\n\tupdate: function() {\n\t\tvar unitsToSpawn = [];\n\t\tif (!this.finished) {\n\t\t\tfor (var i = this.units.length; i--; ) {\n\t\t\t\tif (this.units[i].time < this.startTime) {\n\t\t\t\t\tunitsToSpawn.push(new (types.units[this.units[i].unit])(this.logic));\n\t\t\t\t\tthis.units.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (this.units.length === 0) {\n\t\t\t\tthis.finished = true;\n\t\t\t\tthis.triggerEvent(events.waveFinished);\n\t\t\t}\n\t\t\tif (unitsToSpawn.length > 0) {\n\t\t\t\tvar remaining = this.units.length;\n\t\t\t\tthis.triggerEvent(events.unitSpawned, remaining); \t\t\t\t\n\t\t\t}\n\t\t\tthis.startTime += constants.ticks;\n\t\t}\n\t\treturn unitsToSpawn;\n\t},\n\t\n});","/*\n * The Standard unit\n */\nvar Mario = exports.Mario = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, Mario.speed, 100, MazeStrategy.manhattan, Mario.hitpoints);\n\t\tthis.createVisual(Mario.sprite, [8,8,8,8]);\n\t},\n}, function(enemy) {\n\tenemy.speed = 2.0;\n\tenemy.hitpoints = 10;\n\tenemy.description = 'You have to be careful with that plumber.';\n\tenemy.nickName = 'Mario';\n\tenemy.sprite = 'mario';\n\ttypes.units.Mario = enemy;\n});\n\n/*\n * The Rope unit\n */\nvar Rope = exports.Rope = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, Rope.speed, 80, MazeStrategy.euclideanNoSQR, Rope.hitpoints);\n\t\tthis.createVisual(Rope.sprite, [4, 4, 4, 4], 0.8);\n\t},\n}, function(rope) {\n\trope.speed = 2.0;\n\trope.hitpoints = 20;\n\trope.description = 'An ugly rope that tries to conquer the zone. Watch out when they mass up!';\n\trope.nickName = 'Rope';\n\trope.sprite = 'rope';\n\ttypes.units.Rope = rope;\n});\n\n/*\n * The Fire Wizard Robe unit\n */\nvar FireWizzrobe = exports.FireWizzrobe = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, FireWizzrobe.speed, 70, MazeStrategy.manhattan, FireWizzrobe.hitpoints);\n\t\tthis.createVisual(FireWizzrobe.sprite, [3, 3, 3, 3], 1.4);\n\t},\n}, function(wizz) {\n\twizz.speed = 3.0;\n\twizz.hitpoints = 30;\n\twizz.description = 'The wizard with the fire robe is quite fast, but does not take very much.';\n\twizz.nickName = 'Wizzrobe';\n\twizz.sprite = 'firewizzrobe';\n\ttypes.units.FireWizzrobe = wizz;\n});\n\n/*\n * The Air Wolf unit\n */\nvar AirWolf = exports.AirWolf = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, AirWolf.speed, 50, MazeStrategy.air, AirWolf.hitpoints);\n\t\tthis.createVisual(AirWolf.sprite, [4]);\n\t},\n}, function(wolf) {\n\twolf.speed = 2.0;\n\twolf.hitpoints = 40;\n\twolf.description = 'The air wolf is the only aerial unit in the game. Do not underestimate him as an air wolf fleet could kill you.';\n\twolf.nickName = 'Wolf';\n\twolf.sprite = 'airwolf';\n\ttypes.units.AirWolf = wolf;\n});\n\n/*\n * The dark nut unit\n */\nvar DarkNut = exports.DarkNut = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, DarkNut.speed, 80, MazeStrategy.euclideanNoSQR, DarkNut.hitpoints);\n\t\tthis.createVisual(DarkNut.sprite, [4, 4, 4, 4]);\n\t},\n}, function(nut) {\n\tnut.speed = 2.5;\n\tnut.hitpoints = 150;\n\tnut.description = 'The dark nut is an ancient warrier that takes quite some hits. His speed is superior to most other units.';\n\tnut.nickName = 'Dark Nut';\n\tnut.sprite = 'darknut';\n\ttypes.units.DarkNut = nut;\n});\n\n/*\n * A derived unit\n */\nvar Speedy = exports.Speedy = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, Speedy.speed, 25, MazeStrategy.diagonalShortCut, Speedy.hitpoints);\n\t\tthis.createVisual(Speedy.sprite, [20]);\n\t},\n}, function(unit) {\n\tunit.speed = 5.2;\n\tunit.hitpoints = 200;\n\tunit.description = 'This unit is just a single blob. It is ultra fast and has quite some armor. It will give you some trouble.';\n\tunit.nickName = 'HAL';\n\tunit.sprite = 'newunit';\n\ttypes.units.Speedy = unit;\n});\n\n/*\n * The big Armored unit\n */\nvar Armos = exports.Armos = Unit.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, Armos.speed, 125, MazeStrategy.euclidean, Armos.hitpoints);\n\t\tthis.createVisual(Armos.sprite, [4, 4, 4, 4], 1.2);\n\t},\n}, function(armos) {\n\tarmos.speed = 1.0;\n\tarmos.hitpoints = 600;\n\tarmos.description = 'The unit is actually called Armos and not Armor, however, Armor would have been a good name as well. You will need some fire power to bring him down.';\n\tarmos.nickName = 'Armos';\n\tarmos.sprite = 'armos';\n\ttypes.units.Armos = armos;\n});","/*\n * The standard shot\n */\nvar StandardShot = exports.StandardShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, StandardShot.speed, 15, StandardShot.damage, StandardShot.impactRadius);\n\t\tthis.createVisual(StandardShot.sprite, [1], 0.25);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('wowpulse');\n \t},\n}, function(std) {\n\tstd.nickName = 'Standard';\n\tstd.description = 'Just an ordinary shot with no special ability.';\n\tstd.sprite = 'sunshot';\n\tstd.frames = 1;\n\tstd.speed = 10;\n\tstd.damage = 1;\n\tstd.impactRadius = 0.5;\n\ttypes.shots.StandardShot = std;\n});\n\n/*\n * The anti-air shot\n */\nvar AirShot = exports.AirShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, AirShot.speed, 10, AirShot.damage, AirShot.impactRadius);\n\t\tthis.createVisual(AirShot.sprite, [1, 1, 1, 1], 0.2);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('flak');\n \t},\n}, function(air) {\n\tair.nickName = 'SAM';\n\tair.description = 'Surface to air missile that is highly effective.';\n\tair.sprite = 'airshot';\n\tair.frames = 4;\n\tair.speed = 2.5;\n\tair.damage = 5;\n\tair.impactRadius = 0.5;\n\ttypes.shots.AirShot = air;\n});\n\n/*\n * The flames\n */\nvar FlameShot = exports.FlameShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, FlameShot.speed, 100, FlameShot.damage, FlameShot.impactRadius);\n\t\tthis.createVisual(FlameShot.sprite, [8]);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('flames');\n \t},\n}, function(flame) {\n\tflame.nickName = 'Red Napalm';\n\tflame.description = \"Napalm power you don't want to mess with.\";\n\tflame.sprite = 'flameshot';\n\tflame.frames = 8;\n\tflame.speed = 1.5;\n\tflame.damage = 8;\n\tflame.impactRadius = 0.5;\n\ttypes.shots.FlameShot = flame;\n});\n\n/*\n * The shot from hell\n */\nvar HellShot = exports.HellShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, HellShot.speed, 75, HellShot.damage, HellShot.impactRadius);\n\t\tthis.createVisual(HellShot.sprite, [12]);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('hellshot');\n \t},\n}, function(hell) {\n\thell.nickName = 'HDEB';\n\thell.description = 'The High Dark Energy Density is shot by the gate to hell. It catches your soul and gives you the rest.';\n\thell.sprite = 'hellshot';\n\thell.frames = 12;\n\thell.speed = 2.0;\n\thell.damage = 300;\n\thell.impactRadius = 0.5;\n\ttypes.shots.HellShot = hell;\n});\n\n/*\n * The icy shot\n */\nvar IceShot = exports.IceShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, IceShot.speed, 200, IceShot.damage, IceShot.impactRadius);\n\t\tthis.createVisual(IceShot.sprite, [4]);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('icy');\n \t},\n}, function(ice) {\n\tice.nickName = 'Snowball 5';\n\tice.description = 'An experimental super cold plasma (cold is relative here).';\n\tice.sprite = 'iceshot';\n\tice.frames = 4;\n\tice.speed = 3.5;\n\tice.damage = 15;\n\tice.impactRadius = 0.5;\n\ttypes.shots.IceShot = ice;\n});\n\n/*\n * A shot from the MG nest\n */\nvar MGShot = exports.MGShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, MGShot.speed, 25, MGShot.damage, MGShot.impactRadius);\n\t\tthis.createVisual(MGShot.sprite, [1, 1, 1, 1], 0.3);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('mgnest');\n \t},\n}, function(mg) {\n\tmg.nickName = 'Nato cal. 7.72';\n\tmg.description = 'Standard MG shot: 7.72 mm full metal jacket that handles most guys.';\n\tmg.sprite = 'mgshot';\n\tmg.frames = 4;\n\tmg.speed = 8.0;\n\tmg.damage = 2;\n\tmg.impactRadius = 0.5;\n\ttypes.shots.MGShot = mg;\n});\n\n/*\n * A laser beam\n */\nvar LaserShot = exports.LaserShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, LaserShot.speed, 25, LaserShot.damage, LaserShot.impactRadius);\n\t\tthis.createVisual(LaserShot.sprite, [6, 6, 6, 6]);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('laser');\n \t},\n}, function(laser) {\n\tlaser.nickName = 'Faser';\n\tlaser.description = 'Neutrino shot: Hits before fired (from the perspective of any observer).';\n\tlaser.sprite = 'lasershot';\n\tlaser.frames = 24;\n\tlaser.speed = 10;\n\tlaser.damage = 7;\n\tlaser.impactRadius = 0.5;\n\ttypes.shots.LaserShot = laser;\n});\n\n/*\n * The shell shot\n */\nvar ShellShot = exports.ShellShot = Shot.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, ShellShot.speed, 25, ShellShot.damage, ShellShot.impactRadius);\n\t\tthis.createVisual(ShellShot.sprite, [1, 1, 1, 1], 0.3);\n\t},\n\tplayInitSound: function() {\n\t\tthis.playSound('artillery');\n \t},\n}, function(shell) {\n\tshell.nickName = 'Shell';\n\tshell.description = 'Hardened steel projectile that is no joke.';\n\tshell.sprite = 'shellshot';\n\tshell.frames = 4;\n\tshell.speed = 16;\n\tshell.damage = 15;\n\tshell.impactRadius = 0.5;\n\ttypes.shots.ShellShot = shell;\n});","/*\n * The efficient MG nest\n */\nvar MGNest = exports.MGNest = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, MGNest.speed, 25, MGNest.range, MGNest.shotType);\n\t\tthis.createVisual(MGNest.sprite, [1]);\n\t},\n}, function(nest) {\n\tnest.description = 'The MG Nest is cheap but powerful. It can help you a lot against low armored units.';\n\tnest.nickName = 'MG Nest';\n\tnest.sprite = 'mgnest';\n\tnest.frames = 1;\n\tnest.shotType = MGShot;\n\tnest.speed = 4.0;\n\tnest.range = 3.0;\n\tnest.cost = 7;\n\ttypes.towers.MGNest = nest;\n});\n\n/*\n * The canon tower\n */\nvar CanonTower = exports.CanonTower = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, CanonTower.speed, 50, CanonTower.range, CanonTower.shotType);\n\t\tthis.createVisual(CanonTower.sprite, [1, 1, 1, 1]);\n\t},\n}, function(canon) {\n\tcanon.description = 'The backbone in war! It has an amazing range and shoots shells, however, the firing speed could be better.';\n\tcanon.nickName = 'Canon';\n\tcanon.sprite = 'canontower';\n\tcanon.frames = 4;\n\tcanon.shotType = ShellShot;\n\tcanon.speed = 1.0;\n\tcanon.range = 8.0;\n\tcanon.cost = 12;\n\ttypes.towers.CanonTower = canon;\n});\n\n/*\n * The flame tower\n */\nvar FlameTower = exports.FlameTower = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, FlameTower.speed, 200, FlameTower.range, FlameTower.shotType);\n\t\tthis.createVisual(FlameTower.sprite, [4]);\n\t},\n}, function(flame) {\n\tflame.description = 'Burn them down but a bit faster ... Excellent for slow armored units, but fails against strong armored enemies.';\n\tflame.nickName = 'Flame tower';\n\tflame.sprite = 'flametower';\n\tflame.frames = 4;\n\tflame.shotType = FlameShot;\n\tflame.speed = 6.0;\n\tflame.range = 2.0;\n\tflame.cost = 15;\n\ttypes.towers.FlameTower = flame;\n});\n\n/*\n * The ice tower\n */\nvar IceTower = exports.IceTower = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, IceTower.speed, 200, IceTower.range, IceTower.shotType);\n\t\tthis.createVisual(IceTower.sprite, [1, 1, 1, 1]);\n\t},\n}, function(ice) {\n\tice.description = 'Cool. Slow shots, but with high efficiency. The right choice against slow strongly armored units.';\n\tice.nickName = 'Ice-Tower';\n\tice.sprite = 'icetower';\n\tice.frames = 4;\n\tice.shotType = IceShot;\n\tice.speed = 2.0;\n\tice.range = 6.0;\n\tice.cost = 25;\n\ttypes.towers.IceTower = ice;\n});\n\n/*\n * The laser tower\n */\nvar LaserTower = exports.LaserTower = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, LaserTower.speed, 25, LaserTower.range, LaserTower.shotType);\n\t\tthis.createVisual(LaserTower.sprite, [1, 1, 1, 1]);\n\t},\n}, function(laser) {\n\tlaser.description = \"Won't play with you, but does it with high efficiency. Really fast low damage shots.\";\n\tlaser.nickName = 'Faser';\n\tlaser.sprite = 'lasertower';\n\tlaser.frames = 4;\n\tlaser.shotType = LaserShot;\n\tlaser.speed = 3.0;\n\tlaser.range = 5.0;\n\tlaser.cost = 29;\n\ttypes.towers.LaserTower = laser;\n});\n\n/*\n * The famous gate to hell\n */\nvar GateToHell = exports.GateToHell = Tower.extend({\n\tinit: function(logic) {\n\t\tthis._super(logic, GateToHell.speed, 200, GateToHell.range, GateToHell.shotType);\n\t\tthis.createVisual(GateToHell.sprite, [6]);\n\t},\n}, function(gate) {\n\tgate.description = 'Paint rules! This is the ultimate weapon of war, but it will not kill high speed units.';\n\tgate.nickName = 'Hellgate';\n\tgate.sprite = 'gatetohell';\n\tgate.frames = 6;\n\tgate.shotType = HellShot;\n\tgate.speed = 1.0;\n\tgate.range = 2.0;\n\tgate.cost = 55;\n\ttypes.towers.GateToHell = gate;\n});","/* # Tower defense\n\nGame component.\n */\nvar TowerDefense = exports.TowerDefense = declare({\n\t\n\t/** A tower defense game `Definition` holds all properties of the game invariant in every game\n\tstate.\n\t*/\n\t'static Definition': declare({\n\t\t/** The following properties belong to the game definition: \n\t\t */\n\t\tconstructor: function TowerDefense$Definition(params) {\n\t\t\t\n\t\t\tbase.initialize(this, params)\n\t\t\t\t/** + `name`: name of the stage.\n\t\t\t\t*/\n\t\t\t\t.string('gameId', { ignore: true })\n\t\t\t\t/** + `mapHeight`: the number of rows of the map.\n\t\t\t\t*/\n\t\t\t\t.integer('mapHeight', { ignore: true })\n\t\t\t\t/** + `mapWidth`: the number of columns of the map.\n\t\t\t\t*/\n\t\t\t\t.integer('mapWidth', { ignore: true })\n\t\t\t\t/** + `creepPath`: an array of pairs (two value arrays) with the positions that define\n\t\t\t\t\tthe path for the _creeps_.\n\t\t\t\t*/\n\t\t\t\t.array('creepPath', { ignore: true })\n\t\t\t\t/** + `towerPlaces`: an array of pairs (two value arrays) with the positions that define\n\t\t\t\t\tthe locations for towers in the map.\n\t\t\t\t*/\n\t\t\t\t.array('towerPlaces', { ignore: true })\n\t\t\t\t/** + `waves`: an array of definitions in the form `[prize, waves]`, where `waves` is an\n\t\t\t\t\tarray of arrays in the form `[time, unitName]`.\n\t\t\t\t*/\n\t\t\t\t.array('waves', { ignore: true })\n\t\t\t\t/** + `startMoney`: the amount of money the player has at the beginning of the game.\n\t\t\t\t*/\n\t\t\t\t.integer('startMoney', { defaultValue: 10, coerce: true })\n\t\t\t\t/** + `startHP`: the amount of hitpoints the player has at the beginning of the game.\n\t\t\t\t*/\n\t\t\t\t.integer('startHP', { defaultValue: 1, coerce: true });\n\t\t},\n\t\t\n\t\t__maze__: function __maze__() {\n\t\t\tvar mkPoint = function (c) {\n\t\t\t\t\treturn new Point(c[0], c[1]);\n\t\t\t\t};\n\t\t\treturn new Maze(new Size(this.mapWidth, this.mapHeight), \n\t\t\t\tthis.creepPath.map(mkPoint), this.towerPlaces.map(mkPoint)\n\t\t\t);\n\t\t},\n\t\t\n\t\t__waveList__: function __waveList__() {\n\t\t\treturn new WaveList(this.waves.map(function (w) {\n\t\t\t\treturn new Wave(null, w[0], w[1].map(function (c) {\n\t\t\t\t\treturn {time: c[0], unit: c[1]};\n\t\t\t\t}));\n\t\t\t}));\n\t\t},\n\t\t\n\t\tgame: function game(params) {\n\t\t\treturn new TowerDefense(base.copy(params || {}, { def: this }));\n\t\t}\n\t}), // declare Definition.\n\t\n/*  mapWidth: int\n\tmapHeight: int\n\tcreepPath: [[int,int]]\n\ttowerPlaces: [[int,int]]\n\twaves; [[int, [function, int]]]\n\t\n\tticks: 25,\n\tmoney : 50, --> startMoney\n\thitpoints : 10, --> startHP\n\tmediPackCost : 5,\n\tmediPackFactor : 1.5,\n\tmediPackHealth : 1,\n\ttowerBuildCost : 5,\n\ttowerBuildFactor : 1.85,\n\ttowerBuildNumber : 4,\n*/\n\tconstructor: function TowerDefense(params) {\n\t\tbase.initialize(this, params)\n\t\t\t.object('def')\n\t\t\t/** The following properties belong to the game state: \n\t\t\t\t+ `money`: the amount of money the player has.\n\t\t\t*/\n\t\t\t.integer('money', { defaultValue: this.def.startMoney, coerce: true })\n\t\t\t/** + `hp`: the amount of hitpoints the player has.\n\t\t\t*/\n\t\t\t.integer('hp', { defaultValue: this.def.startHP, coerce: true })\n\t\t\t/** + `level`: the current level the game is in.\n\t\t\t*/\n\t\t\t.integer('level', { defaultValue: 0, coerce: true })\n\t\t\t/** + `towers`: an array of `Tower` types (i.e. constructors).\n\t\t\t*/\n\t\t\t.array('towers', { ignore: true });\n\t\t/** The default for `towers` is no tower (i.e. `null`) at every place.\n\t\t*/\n\t\tif (!this.towers) {\n\t\t\tthis.towers = base.Iterable.repeat(null, this.def.towerPlaces.length).toArray();\n\t\t}\n\t},\n\t\n\tresult: function result() {\n\t\tif (this.hp <= 0) { // Defeat.\n\t\t\treturn this.level - this.def.waves.length - 1;\n\t\t} else if (this.level >= this.def.waves.length) { // Victory.\n\t\t\treturn this.hp + this.money / constants.mediPackCost;\n\t\t} else { // Game is not finished.\n\t\t\treturn null;\n\t\t}\n\t},\n\t\n\t/** Builds and initializes a GameLogic instance.\n\t*/\n\t__logic__: function __logic__(view) {\n\t\tview = view || new View(0, 0);\n\t\tvar maze = this.def.__maze__(),\n\t\t\twaveList = this.def.__waveList__(),\n\t\t\tlogic = new GameLogic(view, maze);\n\t\tlogic.gameId = this.def.gameId;\n\t\tlogic.state = GameState.building;\n\t\tlogic.player.money = 999; // FIXME\n\t\tthis.towers.forEach(function (TowerType, i) {\n\t\t\tif (TowerType) {\n\t\t\t\tlogic.buildTower(maze.turrets[i], TowerType);\n\t\t\t}\n\t\t});\n\t\tlogic.player.money = this.money;\n\t\tlogic.player.hitpoints = this.hp;\n\t\twaveList.index = this.level;\n\t\tlogic.setWaves(waveList);\n\t\treturn logic;\n\t},\n\t\n\t/** Returns the params for a `TowerDefense` constructor given a `GameLogic` instance. \n\t*/\n\tfromGameLogic: function fromGameLogic(logic) {\n\t\tvar towers = base.iterable(logic.towers).map(function (t) {\n\t\t\t\tvar coord = t.mazeCoordinates;\n\t\t\t\treturn [coord.x +','+ coord.y, t];\n\t\t\t}).toObject();\n\t\treturn new (this.constructor)({\n\t\t\tdef: this.def,\n\t\t\tmoney: logic.player.money,\n\t\t\thp: logic.player.hitpoints,\n\t\t\tlevel: logic.waves.index,\n\t\t\ttowers: logic.maze.turrets.map(function (c) {\n\t\t\t\tvar t = towers[c.x +','+ c.y];\n\t\t\t\treturn t ? t.constructor : null;\n\t\t\t})\n\t\t});\n\t},\n\t\n\t/** The argument `move` must be an array of tower constructors.\n\t*/\n\tnext: function next(move) {\n\t\tvar that = this,\n\t\t\tlogic = this.__logic__();\n\n\t\tfor (var i = 0; i < move.length; i++) { // Sell missing or modified turrets.\n\t\t\tif (move[i] !== this.towers[i] && this.towers[i]) {\n\t\t\t\tlogic.destroyTower(logic.maze.turrets[i]);\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\tfor (i = 0; i < move.length; i++) { // Buy new turrets.\n\t\t\tif (move[i] && move[i] !== this.towers[i] && move[i].cost <= logic.player.money) {\n\t\t\t\tlogic.buildTower(logic.maze.turrets[i], move[i]);\n\t\t\t}\n\t\t}\n\n\t\tvar future = new base.Future();\n\t\tlogic.addEventListener(events.playerDefeated, function () {\n\t\t\tfuture.resolve(logic);\n\t\t});\n\t\tlogic.addEventListener(events.waveDefeated, function () {\n\t\t\tfuture.resolve(logic);\n\t\t});\n\t\tlogic.start();\n\t\tlogic.beginWave();\n\t\treturn future.then(function (logic) {\n\t\t\tlogic.pause();\n\t\t\treturn that.fromGameLogic(logic);\n\t\t});\n\t},\n\n\ttoString: function toString(){\n\t\treturn 'TowerDefense('+ this.money +','+ this.hp +','+ this.level +',['+\n\t\t\tthis.towers.map(function (t) { return t ? t.nickName : '';}).join(',') +'])';\n\t}\n}); // declare TowerDefense","/**\n*/\nvar AIPlayer = exports.AIPlayer = declare({\n\tconstructor: function AIPlayer(params) {\n\t\tparams = params || {};\n\t\tthis.name = params.name || 'AIPlayer';\n\t\tthis.size = +params.size || 10;\n\t\tthis.steps = +params.steps || 10;\n\t\tthis.expansionRate = +params.expansionRate || 0.5;\n\t\tthis.mutationRate = +params.mutationRate || 0.25;\n\t},\n\t\n\t/** The decision of the AI player is an optimization, represented by a subclass of \n\t`inveniemus.Problem`.\n\t*/\n\tProblem: declare(inveniemus.Problem, {\n\t\tconstructor: function AIPlayer$Problem(params) {\n\t\t\tparams.objectives = +Infinity; // Maximization.\n\t\t\tinveniemus.Problem.call(this, params);\n\t\t\tthis.game = params.game;\n\t\t\tthis.towerTypes = base.iterable(types.towers).select(1).toArray();\n\t\t\tvar range = { \n\t\t\t\tmin: 0, \n\t\t\t\tmax: this.towerTypes.length + 1, \n\t\t\t\tdiscrete: true \n\t\t\t};\n\t\t\tthis.__elementModel__ = base.Iterable.repeat(range, this.game.def.towerPlaces.length).toArray();\n\t\t},\n\t\t\n\t\tmapping: function mapping(element) {\n\t\t\tvar prob = this;\n\t\t\treturn element.values.map(function (v) {\n\t\t\t\treturn prob.towerTypes[v] || null;\n\t\t\t});\n\t\t},\n\t\t\n\t\temblem: function emblem(element) {\n\t\t\tvar move = this.mapping(element);\n\t\t\treturn '['+ move.map(function (m) { \n\t\t\t\treturn m ? m.nickName : ''; \n\t\t\t}).join('|') +']'; \n\t\t},\n\t\t\n\t\tevaluation: function evaluation(element) {\n\t\t\tvar p = this,\n\t\t\t\tmove = this.mapping(element);\n\t\t\treturn this.game.next(move).then(function (game2) {\n\t\t\t\tvar r = game2.hp + game2.money / constants.mediPackCost;\n\t\t\t\treturn r;\n\t\t\t});\n\t\t}\n\t}),\n\t\n\t/** Return the best move for the given `game` state.\n\t*/\n\tdecision: function decision(game) {\n\t\tvar problem = new this.Problem({ game: game }),\n\t\t\tga = new inveniemus.metaheuristics.GeneticAlgorithm({ problem: problem, \n\t\t\t\tsize: this.size,\n\t\t\t\tsteps: this.steps, \n\t\t\t\texpansionRate: this.expansionRate,\n\t\t\t\tmutationRate: this.mutationRate\n\t\t\t});\n\t\t/** Every generation repeated elements are removed and replaced with random elements.\n\t\t*/\n\t\tga.events.on('advanced', function () {\n\t\t\tfor (ga.nub(); ga.state.length < ga.size; ) {\n\t\t\t\tga.state.push(problem.newElement());\n\t\t\t}\n\t\t\t// console.log(problem.emblem(ga.state[0]) +' = '+ ga.state[0].evaluation);//FIXME\n\t\t});\n\t\treturn ga.run().then(function (best) {\n\t\t\treturn best.mapping();\n\t\t});\n\t},\n\t\n\t/** Play the `game` until the end.\n\t*/\n\tplay: function play(game, callback) {\n\t\tvar player = this;\n\t\treturn base.Future.doWhile(function (g) {\n\t\t\tg = g || game;\n\t\t\treturn player.decision(g).then(function (move) {\n\t\t\t\t// console.log('stateBefore: '+ g);\n\t\t\t\t// console.log('move:'+ move.map(function (f) { return f && f.nickName; }).join('|'));//FIXME\n\t\t\t\treturn g.next(move).then(function (g2) {\n\t\t\t\t\tif (callback) {\n\t\t\t\t\t\tcallback(g, move, g2);\n\t\t\t\t\t}\n\t\t\t\t\t// console.log('stateAfter: '+ g2);//FIXME\n\t\t\t\t\treturn g2;\n\t\t\t\t});\n\t\t\t});\n\t\t}, function (g) {\n\t\t\treturn !g.result();\n\t\t});\n\t}\n}); // declare AIPlayer","/**TODO\n*/\n\nvar scenarios = exports.scenarios = {\n\n\t/** Simple test game. 01\n\t*/\n\tTest01: new (TowerDefense.Definition)({ \n\t\tgameId: 'Test01',\n\t\tmapWidth: 8,\n\t\tmapHeight: 8,\n\t\tcreepPath: [\n\t\t\t[1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [2, 4], [3, 4], [3, 5], [3, 6], [4, 6], [5, 6], [5, 5],\n\t\t\t[5, 4], [5, 3], [5, 2], [5, 1], [5, 0]\n\t\t],\n\t\ttowerPlaces: [\n\t\t\t[2, 3], [4, 5], [4, 3], [2, 1], [2, 5]\n\t\t],\n\t\twaves: [\n\t\t\t[10, [[1, \"Mario\"], [400, \"Mario\"], [1000, \"Rope\"], [1200, \"Rope\"]]],\n\n\t\t\t[12, [[1, \"Mario\"], [350, \"Rope\"],\n\t\t\t[850, \"Mario\"], [1100, \"Mario\"],\n\t\t\t[1800, \"Rope\"], [2500, \"Rope\"]]],\n\n\t\t\t[16, [[1, \"Mario\"], [350, \"Rope\"], [500, \"FireWizzrobe\"],\n\t\t\t[1000, \"Rope\"], [1500, \"FireWizzrobe\"]]],\n\n\t\t\t[20, [[1, \"Speedy\"], [200, \"FireWizzrobe\"], [500, \"Rope\"],\n\t\t\t[600, \"FireWizzrobe\"], [900, \"FireWizzrobe\"],\n\t\t\t[1300, \"FireWizzrobe\"], [2800, \"DarkNut\"]]],\n\n\t\t\t[22, [[1, \"FireWizzrobe\"], [600, \"Rope\"],\n\t\t\t[1500, \"FireWizzrobe\"], [2000, \"Rope\"],\n\t\t\t[2800, \"FireWizzrobe\"], [3700, \"DarkNut\"], [4500, \"DarkNut\"],\n\t\t\t[6000, \"FireWizzrobe\"]]],\n\n\t\t\t[25, [[1, \"DarkNut\"], [500, \"FireWizzrobe\"], [1000, \"FireWizzrobe\"],\n\t\t\t[1600, \"FireWizzrobe\"], [2500, \"DarkNut\"], [3000, \"DarkNut\"],\n\t\t\t[4000, \"FireWizzrobe\"]]],\n\n\t\t\t[25, [[1, \"DarkNut\"], [600, \"FireWizzrobe\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"Rope\"], [2500, \"Rope\"], [2600, \"Rope\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4900, \"FireWizzrobe\"], [6000, \"Armos\"]]],\n\n\t\t\t[30, [[1, \"DarkNut\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"FireWizzrobe\"], [2800, \"FireWizzrobe\"],\n\t\t\t[4000, \"Armos\"], [5000, \"DarkNut\"], [5400, \"FireWizzrobe\"], [6000, \"FireWizzrobe\"]]]\n\t\t],\n\t\tstartMoney: 25,\n\t\tstartHP: 10\n\t}), // Test01\n\n\n\t/** Simple test game. 02\n\t*/\n\tTest02: new (TowerDefense.Definition)({\n\t\tgameId: 'Test02',\n\t\tmapWidth: 8,\n\t\tmapHeight: 8,\n\t\tcreepPath: [\n\t\t\t[0, 4], [1, 4], [2, 4], [2, 5], [2, 6], [3, 6], [4, 6], [4, 5], [4, 4], [4, 3], [4, 2], [5, 2],\n\t\t\t[6, 2], [7, 2]\n\t\t],\n\t\ttowerPlaces: [\n\t\t\t[3, 4], [1, 5], [5, 3]\n\t\t],\n\t\twaves: [\n\n\t\t\t[10, [[1, \"Mario\"], [400, \"Mario\"], [1000, \"Rope\"], [1200, \"Rope\"]]],\n\n\t\t\t[12, [[1, \"Mario\"], [350, \"Rope\"],\n\t\t\t[850, \"Mario\"], [1100, \"Mario\"],\n\t\t\t[1800, \"Rope\"], [2500, \"Rope\"]]],\n\n\t\t\t[16, [[1, \"Mario\"], [350, \"Rope\"], [500, \"FireWizzrobe\"],\n\t\t\t[800, \"FireWizzrobe\"], [1000, \"Rope\"], [1500, \"FireWizzrobe\"]]],\n\n\t\t\t[20, [[1, \"Speedy\"], [200, \"FireWizzrobe\"], [500, \"Rope\"], [550, \"Rope\"],\n\t\t\t[600, \"FireWizzrobe\"], [680, \"Rope\"], [900, \"FireWizzrobe\"],\n\t\t\t[1300, \"FireWizzrobe\"], [2800, \"DarkNut\"]]],\n\n\t\t\t[22, [[1, \"FireWizzrobe\"], [500, \"Rope\"], [550, \"Rope\"],\n\t\t\t[1000, \"FireWizzrobe\"], [1200, \"Rope\"], [1350, \"Rope\"],\n\t\t\t[1600, \"FireWizzrobe\"], [2500, \"DarkNut\"], [3000, \"DarkNut\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4200, \"FireWizzrobe\"]]],\n\n\t\t\t[25, [[1, \"DarkNut\"], [500, \"FireWizzrobe\"], [1000, \"FireWizzrobe\"], [1200, \"DarkNut\"],\n\t\t\t[1600, \"FireWizzrobe\"], [2500, \"DarkNut\"], [3000, \"DarkNut\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4200, \"DarkNut\"]]],\n\n\t\t\t[20, [[1, \"DarkNut\"], [250, \"FireWizzrobe\"], [600, \"FireWizzrobe\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"Rope\"], [2300, \"Rope\"], [2400, \"Rope\"], [2500, \"Rope\"], [2600, \"Rope\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4200, \"DarkNut\"], [4400, \"FireWizzrobe\"], [6000, \"Armos\"]]],\n\n\t\t\t[25, [[1, \"DarkNut\"], [250, \"DarkNut\"], [600, \"DarkNut\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"FireWizzrobe\"], [2300, \"FireWizzrobe\"], [2400, \"Rope\"], [2500, \"Rope\"], [2600, \"FireWizzrobe\"],\n\t\t\t[4000, \"Armos\"], [5000, \"DarkNut\"], [5400, \"FireWizzrobe\"], [6000, \"FireWizzrobe\"], [8000, \"Armos\"]]]\n\t\t],\n\t\tstartMoney: 15,\n\t\tstartHP: 10\n\t}), // Test02\n\n\n\t/** Simple test game. 03\n\t*/\n\tTest03: new (TowerDefense.Definition)({\n\t\tgameId: 'Test03',\n\t\tmapWidth: 8,\n\t\tmapHeight: 8,\n\t\tcreepPath: [\n\t\t\t//[1,0], [1,1], [1,2], [2,2], [3,2], [3,3], [3,4], [3,5], [4,5], [5,5], [6,5], [7,5]\n\t\t\t[0, 4], [1, 4], [2, 4], [3, 4], [4, 4], [4, 3], [4, 2], [5, 2], [6, 2], [7, 2]\n\t\t],\n\t\ttowerPlaces: [\n\t\t\t//[2,3], [4,4], [2,1], [5,6]\n\t\t\t[2, 3], [4, 5], [5, 3], [2, 5]\n\t\t],\n\t\twaves: [\n\t\t\t[8, [[1, \"Mario\"], [700, \"Mario\"], [1800, \"Rope\"], [2800, \"Rope\"], [4000, \"DarkNut\"]]],\n\n\t\t\t[8, [[1, \"Mario\"], [350, \"Mario\"], [700, \"Mario\"],\n\t\t\t[1800, \"Rope\"], [2300, \"Rope\"], [2800, \"Rope\"],\n\t\t\t[3800, \"FireWizzrobe\"], [5000, \"DarkNut\"]]],\n\n\t\t\t[9, [[1, \"Mario\"], [350, \"Rope\"], [400, \"Mario\"], [600, \"Rope\"],\n\t\t\t[800, \"Rope\"], [1000, \"Rope\"], [1500, \"FireWizzrobe\"]]],\n\n\t\t\t[12, [[1, \"FireWizzrobe\"], [450, \"Rope\"],\n\t\t\t[600, \"FireWizzrobe\"], [900, \"FireWizzrobe\"], [1200, \"FireWizzrobe\"]]],\n\n\t\t\t[15, [[1, \"FireWizzrobe\"], [500, \"Rope\"], [550, \"Rope\"],\n\t\t\t[600, \"Rope\"], [650, \"Rope\"], [700, \"Rope\"],\n\t\t\t[1600, \"FireWizzrobe\"], [4000, \"FireWizzrobe\"], [4200, \"FireWizzrobe\"]]],\n\n\t\t\t[20, [[1, \"DarkNut\"], [500, \"FireWizzrobe\"], [1000, \"FireWizzrobe\"], [1200, \"DarkNut\"],\n\t\t\t[1600, \"FireWizzrobe\"], [2500, \"DarkNut\"], [3000, \"DarkNut\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4200, \"DarkNut\"]]],\n\n\t\t\t[20, [[1, \"DarkNut\"], [250, \"FireWizzrobe\"], [600, \"FireWizzrobe\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"Rope\"], [2300, \"Rope\"], [2400, \"Rope\"], [2500, \"Rope\"], [2600, \"Rope\"],\n\t\t\t[4000, \"FireWizzrobe\"], [4200, \"DarkNut\"], [4400, \"FireWizzrobe\"], [6000, \"Armos\"]]],\n\n\t\t\t[25, [[1, \"DarkNut\"], [250, \"DarkNut\"], [600, \"DarkNut\"], [1000, \"DarkNut\"],\n\t\t\t[2200, \"FireWizzrobe\"], [2300, \"FireWizzrobe\"], [2400, \"Rope\"], [2500, \"Rope\"], [2600, \"FireWizzrobe\"],\n\t\t\t[4000, \"Armos\"], [5000, \"DarkNut\"], [5400, \"FireWizzrobe\"], [6000, \"FireWizzrobe\"], [8000, \"Armos\"]]]\n\t\t],\n\t\tstartMoney: 14,\n\t\tstartHP: 10\n\t}) // Test03 y Test04\n\n}; // scenarios","/** See __prologue__.js\n*/\n\treturn exports;\n}"]}